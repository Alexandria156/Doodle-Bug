<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Appraisal Game</title>
    <link rel="stylesheet" href="main-page.css">
</head>
<h1 id = "title">Create a Piece of Art Given the Request</h1>
<h2 id = "description">Your work will be evaluated!</h2>
<h6 id = "clarifcation">just a little bit!</h6>
<h3 id="userCanvas">Your Canvas</h3>

<body>
    <div id="game">
        <div id = "AIRequest">
            <span id ="AIPrompt">
                Illustrate a portrait of:
            </span>
            <h3 id ="newWord"></h3>
        </div>
        <div id = "referenceImage" style="display: none;">
            <img id = "searchedImage" src="" alt = "Reference">
        </div>
    </div>
    <div id="gridLayout">
        <div id="board">

            <canvas id="sketchCanvas" width="1000" height="500" style="border:5px
        solid #000000;">
            </canvas>
        </div>
        <div id="canvasTools">
            <table>
                <thread>
                    <th>
                    <td>
                        <label id="sizeTitle">
                            Brush Size
                            <br>
                            <input type="range" value="10" min="5" max="50" step="1" id="brushSize"></input>
                        </label>
                        <label id="colorTitle">
                            Color Picker
                            <br>
                            <input id="colorPicker" type="color" value="#000000">
                        </label>
                        <button id="clear">Clear Canvas</button>
                        <button id = "submit">Submit Work</button>
                        <p id ="critque" value =""></p>
                    </td>
                    </th>
                </thread>
            </table>
            <!--<script type ="module" src = "https://esm.run/@google/generative-ai"></script>-->
            <!--<script type = "module" src="drawingGame.js"></script>-->
            <script type ="module">
                import { GoogleGenerativeAI } from '@google/generative-ai';
const ai = new GoogleGenerativeAI({ apiKey: 'AIzaSyBD3jJViJ7S1kA2xE-jCTgCPV5P7s2ICD0' });

const words = ["Apple", "Airplane", "Backpack", "Arm", "Bear", "Horse",
    "Bumblebee", "Water bottle", "Carrot", "Clouds", "Chicken", "Chair",
    "Butterfly", "Crown", "T-Rex", "Elephant", "Dolphin", "Dog", "Curtains",
    "Crayons", "Flower", "Fork", "Frog", "Grapes", "Strawberry", "Helicopter",
    "Burger", "Sandwich", "Bottle of glue", "Rabbit", "Parrot", "Eagle",
    "Mountain range", "Tree", "Horse", "Evil and intimidating horse",
    "Coat", "Shirt", "Pair of sneakers", "Mouth", "Eyes", "hedgehog",
    "Shark", "Cityscape", "Farmland", "Bicylce", "Skull", "Monkey",
    "Juice carton", "Owl", "Mouse", "Rat", "Iguana", "Snake", "Lion",
    "Maple leaf", "Hockey rink", "Pretzel", "Pirate", "Pie", "Purse",
    "Handbag", "Shopping cart", "Pumpkin", "Radio", "Car", "Skatboard",
    "Roller skates", "Bat", "Duck", "Scissors", "Refrigerator running",
    "Bell pepper", "Rainbow after rain", "Highway", "Laptop", "PC", "Sofa",
    "Shovel", "Suitcase", "Teddie bear", "Cube", "Truck", "Wristwatch",
    "Zebra", "Giraffe", "Mole", "Wagon", "Boar", "Palm tree", "Volcano"
];


const promptWord = document.getElementById("newWord");
const userCanvas = document.getElementById("sketchCanvas");
const colorPicker = document.getElementById("colorPicker");
const sizeChange = document.getElementById("brushSize");
const wipeCanvas = document.getElementById("clear");
const submitButton = document.getElementById("submit");
const displayFeedback = document.getElementById("critque");

let currentWord = "";


function startGame(){
    getAWord();
}

function getAWord() {
    let randomNum = Math.floor((Math.random()) * (words.length));

    currentWord = words[randomNum];
    promptWord.textContent = currentWord;
    console.log("New word: ", currentWord);
    return currentWord;
}

async function submission(){
    submitButton.disabled = true;
    submitButton.textContent = "Reviewing . . ."

    try {
        const canvasImg = userCanvas.toDataURL('image/png');
        const base64 = canvasImg.split(',')[1];

        const critque = await evaluateIlust(base64, currentWord);
        displayFeedback.textContent = critque;
        submitButton.disabled = true;
        submitButton.textContent = "Submit your work!";
    } 
    catch (error) {
        console.log("Error in submisson:", error);
    }
}

function displayResponse(critque){
    return critque;
}

async function evaluateIlust(canvasImage, prompt) {
    try {
        console.log("Reveiwing illustration");

        const model = ai.getGenerativeModel({ model: "gemini-pro-vision" });
        const evalPrompt = `
        You are an amiable art appraiser who also happens to be an isopod. You request that someone illustrate
        something given one word and they will present their work to you for you to evaluate. Compare the artist's
        work to a reference image if provided, otherwise give light critque based on your own knowledge of years of
        studying art. Also suggest at most 3 resources based on the quality of the artist's work and how well
        it represents the word. These can be YouTube tutorials, blog posts, books, and modern artists that 
        specialize in figure drawing. Maintain kindness and professionalism, but dont be afraid to use more 
        colloqial and flowerly language. You are also an old Guyanese man with 3 grandkids and like to remincise sometimes.
        Please keep responses short and sweet!

        Original request: "${prompt}"
        Give some additional grace to the artist and try to identify the most notable features as they may be 
        using a mouse.
        `;
        const result = await model.generateContent([
            evalPrompt,
            { 
                inlineData: { 
                    data: canvasImage, 
                    mimeType: "image/png" 
                }
            }
        ]);

        const aiResponse = await result.response;
        return aiResponse.text();
    }
    catch (error) {
        return error;
    }
}

window.addEventListener("DOMContentLoaded", () => {
    userCanvas;
    colorPicker;
    sizeChange;
    wipeCanvas;

});
submitButton.addEventListener("click", submission);
            </script>
            <script type = "module" src="userDrawingInput.js"></script>
        </div>
    </div>
    <div>
    </div>
</body>

</html>